let btn_value_reset = document.getElementById('js-btn-clear');
let inp = document.getElementById('inp_val');

inp.addEventListener('keyup', function (e) {
    let input_value = inp.value;
    let value_len = input_value.length;
    if (value_len > 0) {
        btn_value_reset.classList.add('active');
    } else if (value_len < 1) {
        btn_value_reset.classList.remove('active');
    }
});

btn_value_reset.addEventListener('click', function (e) {
    e.preventDefault();
    inp.value = '';
    btn_value_reset.classList.remove('active');
});


function set_interval(interval) {
    var image = document.getElementById("img");

    function updateImage() {
        image.src = image.src.split("?")[0] + "?" + new Date().getTime();
    }

    setInterval(updateImage, interval);
}

function reload() {
    var container = document.getElementById("frame_container");
    var content = container.innerHTML;
    container.innerHTML = content;

    //this line is to watch the result in console , you can remove it later
    console.log("Refreshed");
}

// ---------- BUTTONS ----------
let btn0 = document.getElementById('btn-0');
let btn1 = document.getElementById('btn-1');
let btn2 = document.getElementById('btn-2');
let btn3 = document.getElementById('btn-3');
let btn4 = document.getElementById('upload-btn-label');
let btn6 = document.getElementById('btn-6');

function uploadSettings() {
    console.log("uploadSettings")
    var fileInput = document.getElementById('upload-btn')
    inp.value = fileInput.files[0].name;

    let xhr = new XMLHttpRequest();
    xhr.open("POST", "/init");
    var formData = new FormData();
    formData.append("file", fileInput.files[0], fileInput.files[0].name);
    console.log("request send")

    xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {
            console.log(xhr.status);
            console.log(xhr.responseText);
            alert(xhr.responseText)
        }
    };
    xhr.send(formData);
    document.getElementById('upload-btn').value = document.getElementById('upload-btn').defaultValue;
}


function uploadMask(){
    var fileInput = document.getElementById('upload-mask-btn')

    let xhr = new XMLHttpRequest();
    xhr.open("POST", "/load_mask");
    var formData = new FormData();
    formData.append("file", fileInput.files[0], fileInput.files[0].name);


    xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {
            console.log(xhr.status);
            console.log(xhr.responseText);
            alert(xhr.responseText)
        }
    };
    xhr.send(formData);

}

btn0.addEventListener('click', function (e) {
    e.preventDefault();

    let xhr = new XMLHttpRequest();
    xhr.open("POST", "/init");
    xhr.setRequestHeader("Accept", "application/json");
    xhr.setRequestHeader("Content-Type", "application/json");

    xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {
            console.log(xhr.status);
            console.log(xhr.responseText);
            alert(xhr.responseText)
        }
    };

    var data = JSON.stringify({"video_url": inp.value});

    xhr.send(data);
});

btn1.addEventListener('click', function (e) {
    e.preventDefault();
    let xhr = new XMLHttpRequest();
    xhr.open("GET", "/set_mode/1");
    xhr.send();
    // window.location.reload();
});
btn2.addEventListener('click', function (e) {
    e.preventDefault();
    let xhr = new XMLHttpRequest();
    xhr.open("GET", "/set_mode/2");
    xhr.send();
    // window.location.reload();
});
btn3.addEventListener('click', function (e) {
    e.preventDefault();
    let xhr = new XMLHttpRequest();
    xhr.open("GET", "/set_mode/3");
    xhr.send();
    // window.location.reload();
});

btn6.addEventListener('click', function (e) {
    e.preventDefault();
    let xhr = new XMLHttpRequest();
    xhr.open("POST", "/clear_mask");
     xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {
            console.log(xhr.status);
            console.log(xhr.responseText);
            alert(xhr.responseText)
        }
    };
    xhr.send();
    // window.location.reload();
});

